name: {{FRAMEWORK_NAME}}
web-url: "http://gui.cockroachdb.l4lb.thisdcos.directory"
scheduler:
  principal: {{FRAMEWORK_PRINCIPAL}}
  user: {{FRAMEWORK_USER}}
pods:
  cockroachdb:
    count: 3
    uris:
      - "https://binaries.cockroachdb.com/cockroach-latest.linux-amd64.tgz"
      - {{BOOTSTRAP_URI}}
    placement: {{NODE_PLACEMENT}}
    tasks:
      node:
        goal: RUNNING
        cpus: {{NODE_CPUS}}
        memory: {{NODE_MEM}}
        configs:
          start:
            template: "{{CONFIG_TEMPLATE_PATH}}/start.sh.mustache"
            dest: "start.sh" 
        cmd: "./bootstrap && chmod +x $MESOS_SANDBOX/start.sh && $MESOS_SANDBOX/start.sh"
        ports:
          gui:
            port: 0
            vip:
              prefix: gui
              port: 80
          internal:
            port: 0
            vip:
              prefix: internal
              port: 26257
        volume:
          path: "cockroachdb-container-path"
          type: {{NODE_DISK_TYPE}}
          size: {{NODE_DISK}}
        readiness-check:
          cmd: "$MESOS_SANDBOX/cockroach-latest.linux-amd64/cockroach node ls --insecure --port=$PORT_INTERNAL >/dev/null 2>/dev/null"
          interval: 5
          delay: 5
          timeout: 100
        health-check:
          cmd: "$MESOS_SANDBOX/cockroach-latest.linux-amd64/cockroach node ls --insecure --port=$PORT_INTERNAL >/dev/null 2>/dev/null"
          interval: 15
          grace-period: 30
          max-consecutive-failures: 3
          timeout: 10
          delay: 0
plans:
  deploy:
    strategy: serial
    phases:
      host:
        strategy: serial 
        pod: cockroachdb
